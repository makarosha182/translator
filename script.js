// База переводов с бумерского на зумерский
const translations = {
    boomerToZoomer: {
        // Приветствия и знакомство
        "доброе утро": "йоу, чё как 🌅",
        "добрый день": "дарова 👋",
        "добрый вечер": "вечерочек в хату ✨",
        "здравствуйте": "хай, как сам? 👋",
        "привет": "прив, чё как",
        "приветствую": "хеллоу, дарова 👋",
        "как дела": "как жизнь, норм? 😎",
        "как поживаете": "как оно вообще? 🤔",
        "как жизнь": "как сам, вайбишь? ✨",
        "рад знакомству": "найс познакомиться 🤝",
        "приятно познакомиться": "кул, рад встрече 😊",
        
        // Прощания
        "до свидания": "пока, бб 👋",
        "всего доброго": "удачи, бро ✌️",
        "спокойной ночи": "споки, сладких снов 😴",
        "до встречи": "увидимся, бб 👋",
        "прощай": "пока-пока 👋",
        "счастливо": "удачи, бро 🤙",
        "до скорого": "скоро увидимся 👀",
        
        // Благодарности
        "спасибо": "спс, красава 🙏",
        "большое спасибо": "дарова, респект 💯",
        "благодарю": "сенкс, топчик 🔥",
        "очень признателен": "респект, спс большое 🙏",
        "не за что": "не за что, норм 👌",
        "пожалуйста": "пожалуйста, без проблем 😊",
        
        // Согласие/несогласие
        "да": "агась, конечно 👍",
        "нет": "неа, не зашло 👎",
        "согласен": "факты, так и есть 💯",
        "не согласен": "кринж, не согласен ❌",
        "хорошо": "окей, найс 👌",
        "отлично": "вау, топчик 🔥",
        "плохо": "не зашло, кринж 😬",
        "превосходно": "огонь, имба 🔥",
        "ужасно": "жесть, кринж 😱",
        "нормально": "норм, окей 👌",
        "так себе": "мимо, не зашло 😐",
        "может быть": "мб, посмотрим 🤔",
        "конечно": "конечно, агась 💯",
        "разумеется": "очев, конечно 👍",
        "ни в коем случае": "низачто, неа ❌",
        
        // Эмоции и чувства
        "я рад": "я в кайфе 😊",
        "я счастлив": "я на хайпе 🎉",
        "я расстроен": "я в печали, грустно 😢",
        "я злюсь": "я в бешенстве, бомбит 😤",
        "мне смешно": "ору, смешно 😂",
        "мне скучно": "скукота, делать нечего 😴",
        "я устал": "я выдохся, устал 😮‍💨",
        "я в восторге": "я в восторге, вау 🤩",
        "я волнуюсь": "я переживаю, стрёмно 😰",
        "мне грустно": "мне грустно, печалька 😔",
        "я удивлён": "я в шоке, вау 😲",
        "мне страшно": "мне стрёмно 😨",
        "я разочарован": "я разочарован, облом 😞",
        "я горжусь": "я горжусь, респект 💪",
        "мне стыдно": "мне стыдно, кринж 😳",
        
        // Оценки и мнения
        "молодец": "красавчик, респект 💪",
        "умница": "мозг, топ 🧠",
        "глупость": "кринж, фейл 🤦",
        "ерунда": "бред, не зашло 😬",
        "замечательно": "огонь, топчик 🔥",
        "прекрасно": "шикарно, топ ✨",
        "великолепно": "имба, огонь 🔥",
        "ужасно": "жесть, кринж 😱",
        "отвратительно": "фу, кринж 🤮",
        "интересно": "интересно, зацепило 🤔",
        "скучно": "скукота, мимо 😴",
        "смешно": "смешно, ору 😂",
        "странно": "странно, чё за 🤨",
        "нормально": "норм, окей 👌",
        "неплохо": "неплохо, зашло 👍",
        "потрясающе": "вау, огонь 🤯",
        "восхитительно": "шикарно, вау ✨",
        
        // Общение и действия
        "позвони мне": "кинь звонок 📱",
        "напиши мне": "напиши в лс 💬",
        "встретимся": "увидимся, встретимся 🤝",
        "пойдём": "го, пошли 🚶",
        "подожди": "секунду, погоди ⏱️",
        "поторопись": "давай быстрее, шевелись ⚡",
        "успокойся": "чилл, расслабься 😌",
        "помолчи": "заткнись, тихо 🤫",
        "послушай": "слышь, слушай 👂",
        "посмотри": "глянь, смотри 👀",
        "подумай": "подумай, вдупли 🤔",
        "расскажи": "расскажи, че там 💬",
        "объясни": "объясни, че как 🗣️",
        "помоги": "помоги, плиз 🙏",
        "извини": "сорян, прости 😅",
        "прости": "прости, сорян 😔",
        
        // Работа и учёба
        "работа": "работка, движ 💼",
        "учёба": "учёбка, универ 📚",
        "начальник": "босс, шеф 👔",
        "коллега": "сотрудник, колега 🤝",
        "домашнее задание": "дз, домашка 📝",
        "экзамен": "экзамен, сессия 📝",
        "урок": "урок, пара 📚",
        "лекция": "лекция, пара 🎓",
        "перерыв": "перерыв, брейк ☕",
        "совещание": "митинг, созвон 💼",
        "проект": "проект, тема 📊",
        "дедлайн": "дедлайн, сдача ⏰",
        "зарплата": "зарплата, бабки 💰",
        "повышение": "повышение, апгрейд 📈",
        "увольнение": "увольнение, вылет 🚪",
        
        // Технологии и интернет
        "компьютер": "комп, пк 💻",
        "телефон": "телефон, мобила 📱",
        "интернет": "инет, онлайн 🌐",
        "фотография": "фотка, фото 📸",
        "видео": "видос, видео 🎥",
        "сообщение": "сообщение, месседж 💬",
        "электронная почта": "мейл, почта 📧",
        "социальные сети": "соцсети, инста 📱",
        "приложение": "приложение, аппка 📲",
        "программа": "прога, софт 💾",
        "файл": "файл, документ 📄",
        "ссылка": "ссылка, линк 🔗",
        "скачать": "скачать, загрузить ⬇️",
        "загрузить": "залить, загрузить ⬆️",
        "подписаться": "подписаться, зафоловить 👥",
        "лайк": "лайк, сердечко ❤️",
        "комментарий": "коммент, отзыв 💬",
        
        // Еда и напитки
        "вкусно": "вкусно, топ 😋",
        "невкусно": "не зашло, фу 🤢",
        "голоден": "голодный, хочу жрать 🍔",
        "сыт": "наелся, сыт 😊",
        "завтрак": "завтрак, бранч 🥐",
        "обед": "обед, ланч 🍽️",
        "ужин": "ужин, диннер 🍕",
        "перекус": "перекус, снэк 🍿",
        "кофе": "кофе, кофеёк ☕",
        "чай": "чай, чаёк 🍵",
        "вода": "вода, водичка 💧",
        "алкоголь": "алкоголь, бухло 🍺",
        
        // Деньги и покупки
        "деньги": "бабки, деньги 💰",
        "дорого": "дорого, не по карману 💸",
        "дешево": "дёшево, норм цена 💵",
        "дорогой": "дорогой, дорогущий 💎",
        "дешёвый": "дешёвый, бюджетный 🏷️",
        "бесплатно": "бесплатно, халява 🎁",
        "скидка": "скидка, сейл 🏷️",
        "покупка": "покупка, шопинг 🛍️",
        "продажа": "продажа, сейл 💳",
        "магазин": "магазин, шоп 🏪",
        "цена": "цена, прайс 💰",
        
        // Внешность и стиль
        "красиво": "красиво, эстетично ✨",
        "некрасиво": "не эстетично, мимо 😬",
        "красивый": "красивый, топовый 😍",
        "некрасивый": "некрасивый, не зашёл 😐",
        "модный": "модный, стильный 👗",
        "немодный": "немодный, старомодный 👴",
        "стильный": "стильный, топовый 😎",
        "одежда": "одежда, шмот 👕",
        "причёска": "причёска, стрижка 💇",
        "макияж": "макияж, мейкап 💄",
        
        // Время и скорость
        "быстро": "быстро, шустро ⚡",
        "медленно": "медленно, тормоза 🐌",
        "сейчас": "сейчас, щас ⏰",
        "скоро": "скоро, щас 🕐",
        "позже": "позже, потом 🕑",
        "рано": "рано, рановато 🌅",
        "поздно": "поздно, поздновато 🌙",
        "вовремя": "вовремя, тайминг 👌",
        "срочно": "срочно, быстрее ⚡",
        "немедленно": "немедленно, прям щас 🚨",
        
        // Понимание и знание
        "понятно": "понял, ясно 👌",
        "непонятно": "не понял, чё? 🤔",
        "знаю": "знаю, в курсе 🧠",
        "не знаю": "не знаю, хз 🤷",
        "понимаю": "понимаю, въезжаю 💡",
        "не понимаю": "не понимаю, не въезжаю 😵",
        "помню": "помню, в курсе 🧠",
        "не помню": "не помню, забыл 🤔",
        "забыл": "забыл, вылетело 😅",
        "вспомнил": "вспомнил, дошло 💡",
        
        // Отношения и люди
        "друг": "друг, братан 🤝",
        "подруга": "подруга, бро 👯",
        "парень": "парень, бойфренд 💑",
        "девушка": "девушка, герлфренд 💕",
        "семья": "семья, родные 👨‍👩‍👧",
        "родители": "родители, предки 👨‍👩‍👦",
        "мама": "мама, мать 👩",
        "папа": "папа, отец 👨",
        "брат": "брат, братан 👦",
        "сестра": "сестра, сеструха 👧",
        "бабушка": "бабушка, бабуля 👵",
        "дедушка": "дедушка, дед 👴",
        
        // Места
        "дом": "дом, хата 🏠",
        "квартира": "квартира, хата 🏢",
        "улица": "улица, стрит 🛣️",
        "город": "город, сити 🏙️",
        "деревня": "деревня, село 🏡",
        "магазин": "магазин, шоп 🏪",
        "ресторан": "ресторан, кафе 🍽️",
        "кино": "кино, киношка 🎬",
        "парк": "парк, паркинг 🌳",
        "школа": "школа, школка 🏫",
        "университет": "университет, универ 🎓",
        "больница": "больница, госпиталь 🏥",
        
        // Действия и состояния
        "иду": "иду, топаю 🚶",
        "бегу": "бегу, мчу 🏃",
        "сижу": "сижу, сидишь 🪑",
        "лежу": "лежу, лежишь 🛋️",
        "сплю": "сплю, дрыхну 😴",
        "ем": "ем, жру 🍔",
        "пью": "пью, бухаю 🥤",
        "читаю": "читаю, зачитываю 📖",
        "смотрю": "смотрю, гляжу 👀",
        "слушаю": "слушаю, слышу 👂",
        "думаю": "думаю, размышляю 🤔",
        "работаю": "работаю, вкалываю 💼",
        "учусь": "учусь, ботаю 📚",
        "играю": "играю, гамаю 🎮",
        "отдыхаю": "отдыхаю, чиллю 😎",
        
        // Разговорные выражения
        "извините": "сорян, извините 😅",
        "простите": "простите, сорян 😔",
        "не беспокойтесь": "не парься, чилл 😌",
        "не волнуйтесь": "не переживай, норм 👌",
        "будьте здоровы": "не болей, здоровья 💪",
        "удачи": "удачи, го 🍀",
        "поздравляю": "поздравляю, респект 🎉",
        "соболезную": "соболезную, держись 😔",
        "приятного аппетита": "приятного аппетита, бон аппетит 🍽️",
        "с днём рождения": "с др, хэппи бёздей 🎂",
        
        // Вопросы
        "что": "что, чё 🤔",
        "где": "где, чё где 📍",
        "когда": "когда, чё когда ⏰",
        "почему": "почему, чё за 🤨",
        "как": "как, чё как 🤷",
        "зачем": "зачем, чё за 🤔",
        "кто": "кто, чё кто 👤",
        "сколько": "сколько, чё сколько 💰",
    }
};

// Создаём обратный словарь для перевода с зумерского на бумерский
const zoomerToBoomer = {};
Object.entries(translations.boomerToZoomer).forEach(([boomer, zoomer]) => {
    // Убираем эмодзи из зумерского для обратного поиска
    const zoomerClean = zoomer.replace(/[^\wа-яА-ЯёЁ\s,]/g, '').trim().toLowerCase();
    zoomerToBoomer[zoomerClean] = boomer;
});

// API ключ Anthropic (можно задать через переменную окружения или напрямую)
const ANTHROPIC_API_KEY = window.ANTHROPIC_API_KEY || '';

// Состояние приложения
let currentMode = 'boomerToZoomer';
let useAI = true; // По умолчанию используем AI

// Элементы DOM
const boomerToZoomerBtn = document.getElementById('boomer-to-zoomer');
const zoomerToBoomerBtn = document.getElementById('zoomer-to-boomer');
const inputText = document.getElementById('input-text');
const outputText = document.getElementById('output-text');
const translateBtn = document.getElementById('translate-btn');
const inputLabel = document.getElementById('input-label');
const outputLabel = document.getElementById('output-label');
const examplesGrid = document.getElementById('examples-grid');
const aiToggle = document.getElementById('ai-toggle');

// Переключение режима перевода
boomerToZoomerBtn.addEventListener('click', () => {
    currentMode = 'boomerToZoomer';
    boomerToZoomerBtn.classList.add('active');
    zoomerToBoomerBtn.classList.remove('active');
    inputLabel.textContent = 'Введите текст на бумерском:';
    outputLabel.textContent = 'Перевод на зумерский:';
    inputText.placeholder = 'Например: Доброе утро, как дела?';
    inputText.value = '';
    outputText.textContent = 'Результат появится здесь...';
    outputText.classList.remove('translated');
    updateExamples();
});

zoomerToBoomerBtn.addEventListener('click', () => {
    currentMode = 'zoomerToBoomer';
    zoomerToBoomerBtn.classList.add('active');
    boomerToZoomerBtn.classList.remove('active');
    inputLabel.textContent = 'Введите текст на зумерском:';
    outputLabel.textContent = 'Перевод на бумерский:';
    inputText.placeholder = 'Например: йоу, чё как';
    inputText.value = '';
    outputText.textContent = 'Результат появится здесь...';
    outputText.classList.remove('translated');
    updateExamples();
});

// Функция перевода через AI (Anthropic Claude)
async function translateWithAI(text, mode) {
    const systemPrompt = mode === 'boomerToZoomer' 
        ? `Ты - переводчик с "бумерского" языка на "зумерский" сленг. 
           Переводи формальные, старомодные фразы на современный молодёжный сленг Gen Z.
           Используй эмодзи, сокращения (спс, бб, го, чилл, кринж, топ, вайб и т.д.).
           Будь креативным и естественным. Переводи ТОЛЬКО текст, без объяснений.`
        : `Ты - переводчик с "зумерского" сленга на "бумерский" формальный язык.
           Переводи молодёжный сленг на формальный, правильный русский язык.
           Убирай сокращения, сленг, эмодзи. Делай текст вежливым и формальным.
           Переводи ТОЛЬКО текст, без объяснений.`;

    try {
        const response = await fetch('https://api.anthropic.com/v1/messages', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'x-api-key': ANTHROPIC_API_KEY,
                'anthropic-version': '2023-06-01'
            },
            body: JSON.stringify({
                model: 'claude-3-5-sonnet-20241022',
                max_tokens: 1024,
                messages: [{
                    role: 'user',
                    content: `${systemPrompt}\n\nПереведи: "${text}"`
                }]
            })
        });

        if (!response.ok) {
            throw new Error('AI перевод недоступен');
        }

        const data = await response.json();
        return data.content[0].text.trim();
    } catch (error) {
        console.error('Ошибка AI перевода:', error);
        // Fallback на словарный перевод
        return translateWithDictionary(text, mode);
    }
}

// Функция словарного перевода (старая логика)
function translateWithDictionary(text, mode) {
    const dict = mode === 'boomerToZoomer' ? translations.boomerToZoomer : zoomerToBoomer;
    
    let result = text.toLowerCase();
    
    // Сортируем ключи по длине (сначала длинные фразы)
    const sortedKeys = Object.keys(dict).sort((a, b) => b.length - a.length);
    
    // Заменяем найденные фразы
    sortedKeys.forEach(key => {
        const regex = new RegExp('\\b' + key.replace(/[.*+?^${}()|[\]\\]/g, '\\$&') + '\\b', 'gi');
        result = result.replace(regex, dict[key]);
    });
    
    // Если ничего не изменилось, добавляем сообщение
    if (result.toLowerCase() === text.toLowerCase()) {
        if (mode === 'boomerToZoomer') {
            return result + ' (уже звучит по-зумерски, бро! 😎)';
        } else {
            return result + ' (уже звучит по-бумерски! 👴)';
        }
    }
    
    // Первая буква заглавная
    result = result.charAt(0).toUpperCase() + result.slice(1);
    
    return result;
}

// Основная функция перевода
async function translate(text, mode) {
    if (useAI) {
        return await translateWithAI(text, mode);
    } else {
        return translateWithDictionary(text, mode);
    }
}

// Обработчик кнопки перевода
translateBtn.addEventListener('click', async () => {
    const input = inputText.value.trim();
    
    if (!input) {
        outputText.textContent = 'Введите текст для перевода! 📝';
        outputText.classList.remove('translated');
        return;
    }
    
    // Показываем индикатор загрузки
    outputText.textContent = 'Перевожу... 🤖';
    outputText.classList.remove('translated');
    translateBtn.disabled = true;
    translateBtn.textContent = '⏳ Перевожу...';
    
    try {
        const translated = await translate(input, currentMode);
        outputText.textContent = translated;
        outputText.classList.add('translated');
    } catch (error) {
        outputText.textContent = 'Ошибка перевода. Попробуйте ещё раз! 😔';
        console.error(error);
    } finally {
        translateBtn.disabled = false;
        translateBtn.textContent = '✨ Перевести';
    }
});

// Enter для перевода
inputText.addEventListener('keypress', (e) => {
    if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        translateBtn.click();
    }
});

// Обновление примеров
function updateExamples() {
    examplesGrid.innerHTML = '';
    
    const dict = currentMode === 'boomerToZoomer' ? translations.boomerToZoomer : zoomerToBoomer;
    const examples = Object.entries(dict).slice(0, 6);
    
    examples.forEach(([from, to]) => {
        const card = document.createElement('div');
        card.className = 'example-card';
        
        const fromDiv = document.createElement('div');
        fromDiv.className = 'from';
        fromDiv.textContent = currentMode === 'boomerToZoomer' ? from : to;
        
        const arrow = document.createElement('div');
        arrow.textContent = '↓';
        arrow.style.textAlign = 'center';
        arrow.style.margin = '5px 0';
        
        const toDiv = document.createElement('div');
        toDiv.className = 'to';
        toDiv.textContent = currentMode === 'boomerToZoomer' ? to : from;
        
        card.appendChild(fromDiv);
        card.appendChild(arrow);
        card.appendChild(toDiv);
        
        // Клик по примеру заполняет поле ввода
        card.addEventListener('click', () => {
            inputText.value = currentMode === 'boomerToZoomer' ? from : to;
            inputText.focus();
        });
        
        examplesGrid.appendChild(card);
    });
}

// Обработчик переключателя AI
aiToggle.addEventListener('change', (e) => {
    useAI = e.target.checked;
    console.log('AI режим:', useAI ? 'включён' : 'выключен');
});

// Инициализация
updateExamples();

